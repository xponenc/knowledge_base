{% extends 'clear_base.html' %}
{% load static %}
{% load humanize %}
{% load custom_filters %}
{% load status_tags %}

{% block extra_css %}
    <link href="{% static 'css/pagination.css' %}" rel="stylesheet">
    <link href="{% static 'css/storage.css' %}" rel="stylesheet">
    <link href="{% static 'css/grader.css' %}" rel="stylesheet">
{% endblock %}

{% block breadcrumbs %}
<nav aria-label="breadcrumb" class="breadcrumb-wrapper">
    <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
        <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a href="{{ website.kb.get_absolute_url }}" itemprop="item">
            <span itemprop="name">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π {{ website.kb.title }}</span>
        </a>
        <meta itemprop="position" content="1" />
        </li>
        <li class="breadcrumb-item active" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem" aria-current="page">
        <span itemprop="name">{{ website.name }}</span>
        <meta itemprop="position" content="2" />
        </li>
    </ol>
</nav>
{% endblock %}

{% block title %}{{ website.name }}{% endblock %}

{% block content %}
<div class="page page--website">
    <div class="page__top">
        <div class="page__info info-page">
            <span class="info-page__banner">–í–ï–ë-–°–ê–ô–¢</span>
            <div class="info-page__header">
                <h2 class="page__heading">{{ website.name }}</h2>
                <h3 class="info-page__heading">–î–µ—Ç–∞–ª–∏ –≤–µ–±-—Å–∞–π—Ç–∞</h3>
            </div>
            <div class="info-page__body">
                <h3 class="info-page__heading"></h3>
                <dl class="description">
                    <dt class="description__term">üîå–û—Å–Ω–æ–≤–Ω–∞—è —Å—Å—ã–ª–∫–∞</dt>
                    <dd class="description__defination">
                        {{ website.base_url }}
                    </dd>
                    <dt class="description__term">üîå–°—Å—ã–ª–∫–∞ –Ω–∞ XML –∫–∞—Ä—Ç—É</dt>
                    <dd class="description__defination">
                        {{ website.xml_map_url }}
                    </dd>
                    <dt class="description__term">üÜî ID</dt>
                    <dd class="description__defination">
                        <pre class="text">{{ website.pk }}</pre> 
                    </dd>
                </dl>
            </div>
            <div class="info-page__footer">
                <div class="btns _jc-fe">
                </div>
            </div>
        </div>
        <div class="page__reports reports">
            <div class="reports__header">
                <h3 class="reports__heading">–û—Ç—á–µ—Ç—ã –ø–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</h3>
            </div>
            <div class="reports__body">
                <table class="elastic-table elastic-table_2-auto">
                    <thead class="elastic-table__thead">
                        <tr class="elastic-table__tr">
                            <th class="elastic-table__th">–æ—Ç—á–µ—Ç</th>
                            <th class="elastic-table__th">—Å—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    <tbody class="elastic-table__tbody">
                        {% for report in website.reports.all %}
                            <tr class="elastic-table__tr">
                                <td class="elastic-table__td">
                                    <a href="{{ report }}" class="link-marker">
                                        <div class="elastic-table__cell">
                                            <span>{{ report }}</span>
                                            <span>{{ report.created_at|date:"d.m.Y H:i" }}</span>
                                            <span>{{ report.author.get_full_name|default:report.author }}</span>
                                        </div>
                                        <svg class="link-marker__marker">
                                            <use xlink:href="{% static 'img/icons/sprite.svg' %}#gears"></use>
                                        </svg>
                                    </a>
                                </td>
                                <td class="elastic-table__td">
                                    {% with report.get_status_display as status %}
                                    {% if report.status == "cr" %}
                                        <span class="tag tag--warning">
                                            {{ status }}
                                        </span>
                                    {% elif report.status == "er" %}
                                        <span class="tag tag--alarm">
                                            {{ status }}
                                        </span>
                                    {% else %}
                                        <span class="tag tag--success">
                                            {{ status }}
                                        </span>
                                    {% endif %}
                                {% endwith %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="reports__footer"></div>
        </div>
        <div class="page__info info-page">
            <div class="info-page__header">
                <h2 class="page__heading">–û—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä—Å–µ—Ä</h2>
                <h3 class="info-page__heading"></h3>
                <p class="text text--mutted">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤—Å–µ–≥–æ —Å–∞–π—Ç–∞. –ï–≥–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–ª–∏—è–µ—Ç –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É.
                </p>
            </div>
            <div class="info-page__body">
                {% if website.mainparser %}
                    <h3 class="info-page__heading">{{ website.mainparser.class_name }}</h3>
                    <dl class="description">
                        <dt class="description__term">–û–ø–∏—Å–∞–Ω–∏–µ</dt>
                        <dd class="description__defination">
                            {{ website.mainparser.description|default:"‚Äî" }}
                        </dd>
                        <dt class="description__term">–ê–≤—Ç–æ—Ä</dt>
                        <dd class="description__defination">
                            {{ website.mainparser.author.get_full_name|default:website.mainparser.author }}
                        </dd>
                        <dt class="description__term">–°–æ–∑–¥–∞–Ω</dt>
                        <dd class="description__defination">
                            <pre class="text">{{ website.mainparser.created_at|date:"d.m.Y H:i" }}</pre> 
                        </dd>
                        <dt class="description__term">–û–±–Ω–æ–≤–ª—ë–Ω</dt>
                        <dd class="description__defination">
                            <pre class="text">{{ website.mainparser.updated_at|date:"d.m.Y H:i" }}</pre> 
                        </dd>
                    </dl>
                {% else %}
                    <p class="text text--muted">–û—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä—Å–µ—Ä –Ω–µ –∑–∞–¥–∞–Ω</p>
                {% endif %}
            </div>
            <div class="info-page__footer">
                <div class="btns _jc-fe">
                    {% if website.mainparser %}
                        <a href="{% url 'parsers:mainparser_detail' website.mainparser.id %}" class="btn btn--reset btn--round" target="_blank" title="–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏" aria-label="–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏">
                            <svg class="link-marker__marker">
                                <use xlink:href="{% static 'img/icons/sprite.svg' %}#details"></use>
                            </svg>
                        </a>
                        <form action="{% url 'sources:website_bulk_parse' website.pk %}" method="POST" class="mb-4">
                            {% csrf_token %}
                            <button type="submit" class="btn btn--reset btn--simple">
                                üì¶ –ü–∞—Ä—Å–∏–Ω–≥ –ø–æ —Å–ø–∏—Å–∫—É
                            </button>
                        </form>
                        <form action="{% url 'sources:website_synchronization' website.pk %}" method="POST" class="mb-4">
                            {% csrf_token %}
                            <button type="submit" class="btn btn--reset btn--simple">
                                üîÑ –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
                            </button>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="page__info info-page">
            <div class="info-page__header">
                <h2 class="page__heading">–¢–µ—Å—Ç–æ–≤—ã–µ –ø–∞—Ä—Å–µ—Ä—ã</h2>
                <h3 class="info-page__heading"></h3>
                <p class="text text--mutted">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞. –¢–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –∑–∞–¥–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –∏ –≤—ã–¥–∞–µ—Ç—Å—è –æ—Ç—á–µ—Ç –æ –ø–∞—Ä—Å–∏–Ω–≥–µ. 
                    –í –¥–µ—Ç–∞–ª—è–∂ –¢–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä—Å–µ—Ä
                </p>
            </div>
            <div class="info-page__body">
            {% for test_parser in website.test_parsers.all %}
                <h3 class="info-page__heading"></h3>
                <div class="source__manage">
                    <dl class="description">
                        <dt class="description__term">–û–ø–∏—Å–∞–Ω–∏–µ</dt>
                        <dd class="description__defination">
                            {{ test_parser.description|default:"‚Äî" }}
                        </dd>
                        <dt class="description__term">–ê–≤—Ç–æ—Ä</dt>
                        <dd class="description__defination">
                            {{ test_parser.author.get_full_name|default:test_parser.author }}
                        </dd>
                        <dt class="description__term">–°–æ–∑–¥–∞–Ω</dt>
                        <dd class="description__defination">
                            <pre class="text">{{ test_parser.created_at|date:"d.m.Y H:i" }}</pre> 
                        </dd>
                        <dt class="description__term">–û–±–Ω–æ–≤–ª—ë–Ω</dt>
                        <dd class="description__defination">
                            <pre class="text">{{ test_parser.updated_at|date:"d.m.Y H:i" }}</pre> 
                        </dd>
                    </dl>
                    <a href="{% url 'parsers:testparser_detail' test_parser.id %}" class="btn btn--reset btn--round" target="_blank" title="–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏" aria-label="–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏">
                        <svg class="link-marker__marker">
                            <use xlink:href="{% static 'img/icons/sprite.svg' %}#details"></use>
                        </svg>
                    </a>
                </div>
            {% empty %}
                <p class="text text--muted">–¢–µ—Å—Ç–æ–≤—ã—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤ –Ω–µ—Ç</p>
            {% endfor %}
            </div>
            <div class="info-page__footer">
                <div class="btns _jc-fe">
                    <a href="{% url 'sources:website_test_parse' website.pk %}" class="btn btn--reset btn--simple">
                        üß™ –¢–µ—Å—Ç–æ–≤—ã–π –ø–∞—Ä—Å–∏–Ω–≥
                    </a>
                </div>
            </div>
        </div>
        
    </div>

    <article class="page__content">
        <div class="mb-4 border-primary border-1 rounded-1">
            <p class="text-muted fst-italic mb-2">
                –ü–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞ - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ c —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ pickle —á–∞–Ω–∫–∞–º (—Ñ–æ—Ä–º–∞—Ç Langchain Document) –ø–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É 
            </p>
            <p class="font-monospace bg-light p-3 rounded">
                    with open(file_path, 'rb') as f:<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;# –ó–∞–≥—Ä—É–∂–∞–µ–º (–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º) —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;all_documents = pickle.load(f)
                </p>
            <form method="post" action="{% url 'chunks:create_chunks_from_website' website.pk %}" class="mb-3" id="create-chunks-form">
                {% csrf_token %}
                {% for key, value in request.GET.items %}
                    <input type="hidden" name="{{ key }}" value="{{ value }}">
                {% endfor %}
                <button type="submit" class="btn btn-primary" id="submit-btn">
                    –°–æ–∑–¥–∞—Ç—å —á–∞–Ω–∫–∏
                    <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true" id="loader"></span>
                </button>
            </form>
        </div>
        <h3 class="page__subheading">üóÇÔ∏è –ò—Å—Ç–æ—á–Ω–∏–∫–∏</h3>
        <form class="page__grader form" action="" method="GET" id="url-filter-form">
            {% csrf_token %}
            {% comment %} {% include "widgets/_form_content-widget.html" %} {% endcomment %}
            <div class="form__container">
                <div class="field-container field-container_wide">
                    <div class="grader grader--bg">
                        <div class="grader__top">
                            <p class="grader__name text text_upper text_transparent text_micro">—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</p>
                            <div class="grader__icons">
                                <svg class="grader__icon grader__icon_filter visually-hidden">
                                    <use xlink:href="{% static 'img/icons/sprite.svg' %}#filter2"></use>
                                </svg>
                                <svg class="grader__icon grader__icon_ascending js-icon-ascending visually-hidden">
                                    <use xlink:href="{% static 'img/icons/sprite.svg' %}#sorted"></use>
                                </svg>
                                <svg class="grader__icon grader__icon_descending js-icon-descending visually-hidden">
                                    <use xlink:href="{% static 'img/icons/sprite.svg' %}#sorted"></use>
                                </svg>
                                <svg class="grader__icon grader__icon_unsort">
                                    <use xlink:href="{% static 'img/icons/sprite.svg' %}#unsorted"></use>
                                </svg>
                            </div>
                        </div>
                        <div class="grader__help">
                            <div class="grader__help-icon grader__icon grader__icon_info" onClick="showHelp(event)">
                                <svg>
                                    <use xlink:href="{% static 'img/icons/sprite.svg' %}#info2"></use>
                                </svg>
                            </div>
                            <div class="grader__help-text">
                                –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–µ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.
                            </div>
                        </div>
                        <div class="grader__body">
                            <div class="grader__section">
                                <div class="grader__header">
                                    <h5 class="grader__heading">—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è </h5>
                                </div>
                                <div class="grader__content">
                                    {% for filter_name, filter_choices in filters.items %}
                                        {% for filter_value, filter_display_name in filter_choices %}
                                            <label class="grader__checkbox checkbox-filter" aria-label="–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è {{ filter_display_name }}">
                                                <input type="checkbox" class="checkbox-filter__input visually-hidden js-filter js-filter-checkbox" name="{{ filter_name }}" value="{{ filter_value }}"{% if request.GET|getlist:filter_name == filter_value %} checked{% endif %} autocomplete="off" onchange="graderChexboxChange(event)">
                                                <span class="checkbox-filter__box"></span>
                                                <span class="checkbox-filter__text">{{ filter_display_name }}</span>
                                            </label>
                                        {% endfor %}
                                    {% endfor %}
                                </div>
                                <div class="grader__header">
                                    <h5 class="grader__heading">–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ</h5>
                                </div>
                                <div class="grader__content grader__range range-grader">
                                    <div class="range-grader__container">
                                        <label class="range-grader__label" for="date_from">
                                            <span>c </span>
                                        </label>
                                        <input class="range-grader__date js-filter" type="date" id="date_from" name="date_from" autocomplete="off" onchange="graderChexboxChange(event)"/>
                                        <label class="range-grader__label" for="date_from"><span> –ø–æ </span>
                                        </label>
                                        <input class="range-grader__date js-filter" type="date" id="date-to" name="date-to" autocomplete="off" onchange="graderChexboxChange(event)"/>
                                    </div>
                                </div>
                                <div class="grader__header">
                                    <h5 class="grader__heading">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</h5>
                                </div>
                                <div class="grader__content">
                                    {% for sorting_value, sorting_name in sorting_list %}
                                        <label class="grader__checkbox checkbox-filter" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ {{ sorting_name }}">
                                            <input type="radio" class="checkbox-filter__input visually-hidden js-sort {% if sorting_value|slice:":1" == "-" %} js-sort-ascending{% else %} js-sort-descending{% endif %}" name="sorting" value="{{ sorting_value }}" onchange="graderChexboxChange(event)">
                                            <svg class="checkbox-filter__icon {% if sorting_value|slice:":1" == "-" %} checkbox-filter__icon_ascending{% else %} checkbox-filter__icon_descending{% endif %}">
                                                <use xlink:href="{% static 'img/icons/sprite.svg' %}#sorted"></use>
                                            </svg>
                                            <span class="checkbox-filter__text">{{ sorting_name }}</span>
                                        </label>
                                    {% endfor %}
                                    <label class="grader__checkbox checkbox-filter" aria-label="–æ—Ç–º–µ–Ω–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É">
                                        <input type="checkbox" class="checkbox-filter__input visually-hidden js-reset-sort" checked onchange="processGraderResetSort(event)">
                                        <svg class="checkbox-filter__icon">
                                            <use xlink:href="{% static 'img/icons/sprite.svg' %}#unsorted"></use>
                                        </svg>
                                        <span class="checkbox-filter__text">–æ—Ç–º–µ–Ω–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="field-container field-container_wide">
                    <label class="custom-field">
                        <input class="custom-field__input" type="text" name="search" value="{{ search_query|default:'' }}" placeholder=" ">
                        <span class="custom-field__placeholder">–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, URL</span>
                    </label>
                </div>
                <button type="submit" class="btn btn--reset btn--round btn--accent" aria-label="–û—Ç–ø—Ä–∞–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å" title="–û—Ç–ø—Ä–∞–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å">
                    <svg class="btn__icon">
                        <use xlink:href="{% static 'img/icons/sprite.svg' %}#search"></use>
                    </svg>
                </button>
            </div>
        <form>
        <div class="page__wrapper" id="url-container">
            {% include "app_sources/include/url_list_page.html" %}
        </div>
    
    </article>
</div>
{% endblock content %}

{% block script %}
    <script src="{% static 'js/grader.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const container = document.querySelector('#url-container');
            const form = document.querySelector('#url-filter-form');

            function fetchAndUpdate(url) {
                fetch(url, {
                    headers: { 'X-Requested-With': 'XMLHttpRequest' }
                })
                .then(response => response.json())
                .then(data => {
                    container.innerHTML = data.html;
                    window.history.pushState({}, '', url); // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
                    syncCheckboxesFromURL();
                });
            }

            // –ü–µ—Ä–µ—Ö–≤–∞—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                const formData = new FormData(form);
                const params = new URLSearchParams(formData);
                const url = `${window.location.pathname}?${params.toString()}`;
                fetchAndUpdate(url);
            });

            // –ü–µ—Ä–µ—Ö–≤–∞—Ç –∫–ª–∏–∫–æ–≤ –ø–æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å .closest)
            container.addEventListener('click', function (e) {
                const link = e.target.closest('.pagination__link');
                if (link && container.contains(link)) {
                    e.preventDefault();
                    const url = link.getAttribute('href');
                    fetchAndUpdate(url);
                }
            });

            function syncCheckboxesFromURL() {
                const params = new URLSearchParams(window.location.search);
                document.querySelectorAll('.js-filter').forEach(input => {
                    const values = params.getAll(input.name);
                    input.checked = values.includes(input.value);
                });
            }
        });
    </script>
    <script>
        document.getElementById('create-chunks-form').addEventListener('submit', function(event) {
            event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã

            const submitBtn = document.getElementById('submit-btn');
            const loader = document.getElementById('loader');
            const form = this;

            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            submitBtn.disabled = true;
            submitBtn.innerHTML = '–û–±—Ä–∞–±–æ—Ç–∫–∞... <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>';
            loader.classList.remove('d-none');

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É —á–µ—Ä–µ–∑ fetch
            fetch(form.action, {
                method: 'POST',
                body: new FormData(form),
                headers: {
                    'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.blob();
            })
            .then(blob => {
                // –°–æ–∑–¥–∞—ë–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'chunk.pickle'; // –ò–º—è —Ñ–∞–π–ª–∞
                document.body.appendChild(a);
                a.click();
                a.remove();
                window.URL.revokeObjectURL(url);

                // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                submitBtn.disabled = false;
                submitBtn.innerHTML = '–°–æ–∑–¥–∞—Ç—å —á–∞–Ω–∫–∏';
                loader.classList.add('d-none');
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —á–∞–Ω–∫–æ–≤');
                // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
                submitBtn.disabled = false;
                submitBtn.innerHTML = '–°–æ–∑–¥–∞—Ç—å —á–∞–Ω–∫–∏';
                loader.classList.add('d-none');
            });
        });
    </script>
{% endblock script%}