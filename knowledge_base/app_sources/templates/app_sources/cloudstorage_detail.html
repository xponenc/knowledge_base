{% extends 'base.html' %}
{% block title %}{{ cloudstorage.name }}{% endblock %}

{% block content %}
<div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">–î–µ—Ç–∞–ª–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞: {{ cloudstorage.name }}</h5>
    </div>
    <div class="card-body">
        <dl class="row mb-0">
            <dt class="col-sm-3">ID</dt>
            <dd class="col-sm-9">{{ cloudstorage.pk }}</dd>

            <dt class="col-sm-3">–ù–∞–∑–≤–∞–Ω–∏–µ</dt>
            <dd class="col-sm-9">{{ cloudstorage.name }}</dd>

            <dt class="col-sm-3">–¢–∏–ø API</dt>
            <dd class="col-sm-9">{{ cloudstorage.api_type }}</dd>

            <dt class="col-sm-3">–£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</dt>
            <dd class="col-sm-9">
                <pre class="bg-light p-2 rounded">{{ cloudstorage.credentials|default:"‚Äî" }}</pre>
            </dd>
        </dl>
    </div>
</div>

<form action="{% url 'sources:cloudstorage_sync' cloudstorage.pk %}" method="POST">
    {% csrf_token %}
    <button type="submit" class="btn btn-success">üîÑ –ü–æ–ª–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–ª–∞–∫–∞</button>
</form>

{% for report in cloudstorage.reports.all %}
    <a href="{% url 'sources:cloudstorageupdatereport_detail' report.pk %}">{{ report }}</a>
{% endfor %}

<h3 class="mb-4">–ö–æ–Ω—Ç–µ–Ω—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</h3>

<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
    {% for document in cloudstorage.network_documents.all %}
        <div class="col">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">
                        <a href="{% url 'sources:networkdocument_detail' document.pk %}" class="text-decoration-none text-primary">
                            {{ document.title|default:"–ë–µ–∑ –∏–º–µ–Ω–∏" }}
                        </a>
                    </h5>
                    <p class="mb-1"><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ document.get_status_display }}</p>
                    <p class="mb-1"><strong>–†–∞–∑–º–µ—Ä:</strong> {{ document.size|filesizeformat }}</p>
                    
                    {% with raw=document.rawcontent_set.first %}
                        {% if raw %}
                            <p class="mb-1">
                                <strong>–ò—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª:</strong>
                                <a href="{{ raw.file.url }}" target="_blank" class="btn btn-sm btn-outline-secondary">
                                    –°–∫–∞—á–∞—Ç—å
                                </a>
                            </p>
                        {% else %}
                            <p class="text-muted">–ò—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</p>
                        {% endif %}
                    {% endwith %}

                    {% with cleaned=document.cleanedcontent_set.first %}
                        {% if cleaned %}
                            <p class="mb-1">
                                <strong>–û—á–∏—â–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç:</strong>
                                <a href="{{ cleaned.file.url }}" target="_blank" class="btn btn-sm btn-outline-success">
                                    –°–∫–∞—á–∞—Ç—å
                                </a>
                            </p>
                        {% else %}
                            <p class="text-muted">–û—á–∏—â–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</p>
                        {% endif %}
                    {% endwith %}
                </div>
            </div>
        </div>
    {% endfor %}
</div>

{% endblock %}
