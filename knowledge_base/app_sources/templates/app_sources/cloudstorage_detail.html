{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block extra_css %}
    <link href="{% static 'css/sources.css' %}" rel="stylesheet">
{% endblock %}

{% block breadcrumbs %}
<nav aria-label="breadcrumb" class="mt-5">
    <ol class="breadcrumb container">
        <li class="breadcrumb-item"><a href="{{ cloudstorage.kb.get_absolute_url }}">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π {{ cloudstorage.kb.title }}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ cloudstorage.name }}</li>
    </ol>
</nav>
{% endblock %}

{% block title %}{{ cloudstorage.name }}{% endblock %}

{% block content %}
<div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">üìÅ –î–µ—Ç–∞–ª–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –æ–±–ª–∞—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞: {{ cloudstorage.name }}</h5>
    </div>
    <div class="card-body">
        <dl class="row mb-0">
            <dt class="col-sm-3">üÜî ID</dt>
            <dd class="col-sm-9">{{ cloudstorage.pk }}</dd>

            <dt class="col-sm-3">üè∑Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ</dt>
            <dd class="col-sm-9">{{ cloudstorage.name }}</dd>

            <dt class="col-sm-3">üîå –¢–∏–ø API</dt>
            <dd class="col-sm-9">{{ cloudstorage.api_type }}</dd>

            <dt class="col-sm-3 ">üîê –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–æ–∫–µ–Ω —Ö–µ—à–∏—Ä–æ–≤–∞–Ω)</dt>
            <dd class="col-sm-9">
                <pre class="bg-light p-2 rounded text-break" style="white-space:pre-wrap;">{{ cloudstorage.credentials|default:"‚Äî" }}</pre>
            </dd>
        </dl>
    </div>
</div>

<form action="{% url 'sources:cloudstorage_sync' cloudstorage.pk %}" method="POST" class="mb-4">
    {% csrf_token %}
    <button type="submit" class="btn btn-success">
        üîÑ –ü–æ–ª–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–ª–∞–∫–∞
    </button>
</form>

{% if cloudstorage.reports.all %}
    <div class="mb-4">
        <h5>üìä –û—Ç—á–µ—Ç—ã</h5>
        <table class="table-auto w-full text-sm">
            <tbody>
                {% for report in cloudstorage.reports.all %}
                    <tr class="border-b">
                        <td class="px-3 py-1">
                            <a href="{% url 'sources:cloudstorageupdatereport_detail' report.pk %}" class="text-blue-600 hover:underline">
                                {{ report }}
                            </a>
                        </td>
                        <td class="px-3 py-1 text-gray-600 whitespace-nowrap">
                            {{ report.created_at|date:"d.m.Y H:i" }}
                        </td>
                        <td class="px-3 py-1 text-gray-600 whitespace-nowrap">
                            {{ report.author.get_full_name|default:report.author }}
                        </td>
                        <td class="py-1 whitespace-nowrap">
                            {% with report.get_status_display as status %}
                                {% if report.status == "cr" %}
                                    <span class="badge bg-success ms-2">
                                        {{ status }}
                                    </span>
                                {% elif report.status == "er" %}
                                    <span class="badge bg-danger ms-2">
                                        {{ status }}
                                    </span>
                                {% else %}
                                    <span class="badge bg-secondary ms-2">
                                        {{ status }}
                                    </span>
                                {% endif %}
                            {% endwith %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endif %}
<h3 class="mb-4">üóÇÔ∏è –ö–æ–Ω—Ç–µ–Ω—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</h3>

<div class="storage__sources">
    {% for document in network_documents %}
        <div class="source">
            <div class="source__header">
                <h3 class="source__heading">
                    <a href="{% url 'sources:networkdocument_detail' document.pk %}" class="source__link link-marker">
                        {{ document.title|default:document.path|default:document.url }}
                        <svg class="link-marker__marker">
                            <use xlink:href="{% static 'img/icons/sprite.svg' %}#root"></use>
                        </svg>
                    </a>
                </h3>
                <div class="source__wrapper">
                    <div class="source__manage">
                        <dl class="source-description">
                            <dt class="source-description__term">—Å—Ç–∞—Ç—É—Å</dt>
                            <dd class="source-description__defination">
                                <span class="tag tag--fat{% if document.status == "cr" %} tag--success{% elif document.status == "de" %} tag--deleted{% elif document.status == "ex" %} .tag--disabled{% else %} tag--alarm{% endif %}">
                                    {{ document.get_status_display }}
                                </span>
                            </dd>
                        </dl>
                        <a class="btn btn--reset btn--round" href="" aria-label="–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞" title="–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞">
                            <svg class="btn__icon">
                                <use xlink:href="{% static 'img/icons/sprite.svg' %}#edit-gear"></use>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
            <div class="source__body">
                <div class="source__wrapper">
                    <div class="source__raw-content">
                        <div class="source__history">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: {{ document.rawcontent_total_count }}</div>
                        <div class="source__content source-content">
                            <div class="source-content__header">
                                <h4 class="source-content__heading">–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞</h4>
                            </div>
                            <div class="source-content__preview">
                                {% if document.active_rawcontent.is_image %}
                                    <img src="{{ document.active_rawcontent.file.url }}" class="source-content__img" alt="preview">
                                {% else %}
                                    <i class="source-content__icon bi {{ document.active_rawcontent.get_icon_class }}"></i>
                                {% endif %}
                            </div>
                            <dl class="source__description source-description">
                                <dt class="source-description__term">–†–∞–∑–º–µ—Ä</dt>
                                <dd class="source-description__defination">{{ document.active_rawcontent.file.size|filesizeformat }}</dd>
                            </dl>
                            <div class="source-content__footer">
                                <div class="btns _jc--fe">
                                    <a class="btn btn--reset btn--round" href="" aria-label="–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç" title="–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç">
                                        <svg class="btn__icon">
                                            <use xlink:href="{% static 'img/icons/sprite.svg' %}#download"></use>
                                        </svg>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="source__wrapper">
                    <div class="source__manage">
                        <dl class="source__description source-description">
                            <dt class="source-description__term">–§–æ—Ä–º–∞—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π</dt>
                            <dd class="source-description__defination"><span class="tag tag--simple">{{ document.get_output_format_display }}</span></dd>
                        </dl>
                        <a class="btn btn--reset btn--round" href="" aria-label="–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π" title="–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π">
                            <svg class="btn__icon">
                                <use xlink:href="{% static 'img/icons/sprite.svg' %}#edit-gear"></use>
                            </svg>
                        </a>
                    </div>
                </div>
                {% if document.active_rawcontent.cleanedcontent %}
                    <div class="source__wrapper">
                        <div class="source__cleaned-content">
                            <div class="source__content source-content">
                                <div class="source-content__header">
                                    <h4 class="source-content__heading">–û—á–∏—â–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞</h4>
                                </div>
                                <div class="source-content__preview source-content__preview--cleaned">
                                    <p class="text text--info">{{ document.active_rawcontent.cleanedcontent.preview }}</p>
                                </div>
                                <dl class="source__description source-description">
                                    <dt class="source-description__term">–†–∞–∑–º–µ—Ä</dt>
                                    <dd class="source-description__defination">{{ document.active_rawcontent.cleanedcontent.file.size|filesizeformat }}</dd>
                                </dl>
                                <div class="source-content__footer">
                                    <div class="btns _jc--fe">
                                        <a class="btn btn--reset btn--round" href="{% url 'sources:cleanedcontent_detail' document.active_rawcontent.cleanedcontent.pk %}" aria-label="–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—á–∏—â–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç" title="–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—á–∏—â–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç">
                                            <svg class="btn__icon">
                                                <use xlink:href="{% static 'img/icons/sprite.svg' %}#download"></use>
                                            </svg>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
                <div class="source__wrapper">
                    <h4 class="source__subheading">–û–ø–∏—Å–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞</h4>
                    <dl class="source__description--info source-description">
                        <dt class="source-description__term">–°—Ç–∞—Ç—É—Å</dt>
                        <dd class="source-description__defination">{{ document.status }}</dd>
                        <dt class="source-description__term">URL</dt>
                        <dd class="source-description__defination">{{ document.url }}</dd>
                        <dt class="source-description__term">–Ø–∑—ã–∫</dt>
                        <dd class="source-description__defination">{{ document.language }}</dd>
                        <dt class="source-description__term">–ù–∞–∑–≤–∞–Ω–∏–µ</dt>
                        <dd class="source-description__defination">{{ document.title }}</dd>
                        <dt class="source-description__term">–¢—ç–≥–∏</dt>
                        <dd class="source-description__defination">{{ document.tags }}</dd>
                        <dt class="source-description__term">–û—à–∏–±–∫–∏</dt>
                        <dd class="source-description__defination">{{ document.error_message }}</dd>
                        <dt class="source-description__term">–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ</dt>
                        <dd class="source-description__defination">{{ document.metadata }}</dd>
                        <dt class="source-description__term">–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ</dt>
                        <dd class="source-description__defination">{{ document.remote_updated }}</dd>
                        <dt class="source-description__term">–î–∞—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ?</dt>
                        <dd class="source-description__defination">{{ document.local_updated }}</dd>
                        <dt class="source-description__term">–î–∞—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ ?</dt>
                        <dd class="source-description__defination">{{ document.synchronized_at }}</dd>
                        <dt class="source-description__term">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</dt>
                        <dd class="source-description__defination">{{ document.created_at }}</dd>
                        <dt class="source-description__term">–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</dt>
                        <dd class="source-description__defination">{{ document.updated_at }}</dd>
                        <dt class="source-description__term">–î–∞—Ç–∞ –º—è–≥–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è</dt>
                        <dd class="source-description__defination">{{ document.soft_deleted_at }}</dd>
                        <dt class="source-description__term">–•—Ä–∞–Ω–∏–ª–∏—â–µ</dt>
                        <dd class="source-description__defination">{{ document.storage }}</dd>
                        <dt class="source-description__term">–°–æ–∑–¥–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö –æ—Ç—á–µ—Ç–∞</dt>
                        <dd class="source-description__defination">{{ document.report }}</dd>
                        <dt class="source-description__term">–ü—É—Ç—å</dt>
                        <dd class="source-description__defination">{{ document.path }}</dd>
                        <dt class="source-description__term">ID –Ω–∞ –æ–±–ª–∞—á–Ω–æ–º –¥–∏—Å–∫–µ</dt>
                        <dd class="source-description__defination">{{ document.file_id }}</dd>
                        <dt class="source-description__term">–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ –≤ –ë–î</dt>
                        <dd class="source-description__defination">{{ document.output_format }}</dd>
                        <dt class="source-description__term">–û–ø–∏—Å–∞–Ω–∏–µ</dt>
                        <dd class="source-description__defination">{{ document.description }}</dd>
                    </dl>
                </div>
            </div>

            <div class="source__footer"></div>
        </div>
        
    {% endfor %}
</div>

{% endblock %}
