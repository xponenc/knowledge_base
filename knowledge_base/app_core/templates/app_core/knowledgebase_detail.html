{% extends 'base.html' %}
{% block title %}{{ object.title }}{% endblock %}
{% block content %}

<h2>{{ object.title }}</h2>
<p>{{ object.description }}</p>

<a href="{% url 'core:knowledgebase_update' object.id %}" class="btn btn-warning">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>

<hr>
<h3>–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</h3>
<hr>
<h3>–û–±–ª–∞—á–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</h3>
<a href="{% url 'sources:cloudstorage_create' knowledgebase.pk %}" class="btn btn-sm btn-success mb-2">+ –î–æ–±–∞–≤–∏—Ç—å –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</a>
{% if knowledgebase.cloudstorage_set.count %}
    <table class="table table-sm table-striped">
        <thead>
            <tr>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–ü—É—Ç—å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for storage in knowledgebase.cloudstorage_set.all %}
                <tr>
                    <td><a href="{% url 'sources:cloudstorage_detail' storage.id %}">{{ storage }}</a></td>
                    <td>{{ storage.root_path }}</td>
                    <td>
                        <a href="{% url 'sources:cloudstorage_update' storage.id %}" class="btn btn-sm btn-warning">‚úè</a>
                        <a href="{% url 'sources:cloudstorage_delete' storage.id %}" class="btn btn-sm btn-danger">üóë</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p class="text-muted">–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –æ–±–ª–∞—á–Ω—ã—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â.</p>
{% endif %}

<hr>
<h3>–õ–æ–∫–∞–ª—å–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</h3>
<a href="{% url 'sources:localstorage_create' %}" class="btn btn-sm btn-success mb-2">+ –î–æ–±–∞–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</a>
{% if knowledgebase.localstorage_set.count %}
    <table class="table table-sm table-striped">
        <thead>
            <tr>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–ê–≤—Ç–æ—Ä</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for storage in knowledgebase.localstorage_set.all %}
                <tr>
                    <td><a href="{% url 'sources:localstorage_detail' storage.id %}">{{ storage.name }}</a></td>
                    <td>{{ storage.author }}</td>
                    <td>
                        <a href="{% url 'sources:localstorage_update' storage.id %}" class="btn btn-sm btn-warning">‚úè</a>
                        <a href="{% url 'sources:localstorage_delete' storage.id %}" class="btn btn-sm btn-danger">üóë</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p class="text-muted">–ù–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â.</p>
{% endif %}

{% if object.history %}
    <table class="table table-sm table-bordered">
        <thead>
            <tr>
                <th>–ö–æ–≥–¥–∞</th>
                <th>–ö—Ç–æ</th>
                <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                <th>–ò–∑–º–µ–Ω–µ–Ω–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in object.history|dictsortreversed:"timestamp" %}
                <tr>
                    <td>{{ entry.timestamp }}</td>
                    <td>{{ entry.username }}</td>
                    <td>{{ entry.action }}</td>
                    <td>
                        <ul>
                            {% for key, val in entry.changes.items %}
                                <li>
                                    <strong>{{ key }}</strong>:
                                    {% if val.from and val.to %}
                                        <span class="text-muted">{{ val.from }}</span> ‚Üí <span class="text-success">{{ val.to }}</span>
                                    {% elif val.added or val.removed %}
                                        {% if val.added %}
                                            –¥–æ–±–∞–≤–ª–µ–Ω–æ:
                                            <ul>
                                                {% for item in val.added %}
                                                    <li>{{ item.username }}</li>
                                                {% endfor %}
                                            </ul>
                                        {% endif %}
                                        {% if val.removed %}
                                            —É–¥–∞–ª–µ–Ω–æ:
                                            <ul>
                                                {% for item in val.removed %}
                                                    <li>{{ item.username }}</li>
                                                {% endfor %}
                                            </ul>
                                        {% endif %}
                                    {% else %}
                                        {{ val }}
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p class="text-muted">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞.</p>
{% endif %}

{% endblock %}
