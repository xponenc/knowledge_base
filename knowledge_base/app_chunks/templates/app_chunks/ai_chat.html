{% extends 'base.html' %}
{% load static %}
{% load status_tags %}
{% load humanize %}

{% block extra_css %}
<style>
    .chat-container {
        max-width: 700px;
        margin: 30px auto;
        padding: 25px;
        background-color: #fff;
        border: 1px solid #dee2e6;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }

    .chat-history {
        height: 350px;
        overflow-y: auto;
        background-color: #f8f9fa;
        border: 1px solid #ced4da;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .message {
        padding: 10px 15px;
        margin: 8px 0;
        border-radius: 10px;
        max-width: 80%;
        word-wrap: break-word;
    }

    .user-message {
        background-color: #d1ecf1;
        margin-left: auto;
        text-align: right;
    }

    .ai-message {
        background-color: #e2e3e5;
        margin-right: auto;
        text-align: left;
    }

    .chat-input input {
        flex: 1;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ced4da;
    }

    .chat-input button {
        white-space: nowrap;
    }

    .clear-button {
        margin-top: 10px;
    }
</style>
{% endblock extra_css %}

{% block title %}–ß–∞—Ç —Å AI{% endblock %}

{% block content %}
<div class="container chat-container">
    <h3 class="mb-2">üß† Ask Frida</h3>
    <p class="text-muted mb-1">Embedded by: <strong>ai-forever/FRIDA</strong></p>
    <p class="text-muted mb-3">Answer by: <strong>OpenAI/gpt-4o-mini</strong></p>

    <p><a href="{% url 'chunks:current_chuncks' %}" class="btn btn-outline-secondary btn-sm">–î–µ–π—Å—Ç–≤—É—é—â–∏–µ —á–∞–Ω–∫–∏</a></p>

    <div class="chat-history" id="chat-history">
        {% for message in chat_history %}
            <div class="message user-message">{{ message.user }}</div>
            <div class="message ai-message">{{ message.ai }}</div>
        {% endfor %}
    </div>

    <form id="chat-form" method="post" class="mb-2">
        {% csrf_token %}
        <div class="chat-input d-flex gap-2">
            <input type="text" name="message" id="message-input" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." required>
            <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </form>

    <form action="{% url 'chunks:clear_frida' %}" method="post">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger clear-button">–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç</button>
    </form>
</div>
{% endblock content %}

{% block script %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const chatHistory = document.getElementById("chat-history");
        if (chatHistory) {
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }
    });
</script>
{% endblock script %}
