<h3>История изменений</h3>
{% if object.history %}
    <table class="table table-sm table-bordered">
        <thead>
            <tr>
                <th>Когда</th>
                <th>Кто</th>
                <th>Действие</th>
                <th>Изменения</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in object.history|dictsortreversed:"timestamp" %}
                <tr>
                    <td>{{ entry.timestamp }}</td>
                    <td>{{ entry.username }}</td>
                    <td>{{ entry.action }}</td>
                    <td>
                        <ul>
                            {% for key, val in entry.changes.items %}
                                <li>
                                    <strong>{{ key }}</strong>:
                                    {% if val.from and val.to %}
                                        <span class="text-muted">{{ val.from }}</span> → <span class="text-success">{{ val.to }}</span>
                                    {% elif val.added or val.removed %}
                                        {% if val.added %}
                                            добавлено:
                                            <ul>
                                                {% for item in val.added %}
                                                    <li>{{ item.username }}</li>
                                                {% endfor %}
                                            </ul>
                                        {% endif %}
                                        {% if val.removed %}
                                            удалено:
                                            <ul>
                                                {% for item in val.removed %}
                                                    <li>{{ item.username }}</li>
                                                {% endfor %}
                                            </ul>
                                        {% endif %}
                                    {% else %}
                                        {{ val }}
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p class="text-muted">История пуста.</p>
{% endif %}